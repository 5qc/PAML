const generateVariables=()=>{const e={},t=document.querySelectorAll("set");for(let n=0;n<t.length;n++){const r=t[n],o=r.getAttribute("name"),s=r.innerHTML;console.log(r.parentElement.tagName);for(let e=0;e<bannedChars.length;e++)if(o.includes(bannedChars[e]))return pamlErr(`Variable name ${o} uses banned character (${bannedChars[e]}).`);e[o]=s,r.remove();const i=RegExp(`(?<!<if exists="){{${o}}}`,"g");document.body.innerHTML=document.body.innerHTML.replace(i,s)}},bannedChars=["{","}","."],pamlErr=e=>console.error(`[PAML] ${e}`),generateFors=()=>{const e=document.querySelectorAll("for");for(let t=0;t<e.length;t++){const n=e[t],r=n.getAttribute("each"),o=n.getAttribute("in"),s=n.getAttribute("varName"),i=n.innerHTML;if("i"===s&&pamlErr('Variable name "i" is reserved.'),o.startsWith("{{")&&o.endsWith("}}"));else{const e=document.querySelector(o),t=e.querySelectorAll(r);n.innerHTML="";for(let e=0;e<t.length;e++){const r=t[e];let o=i,l=RegExp(`{{${s}}}`,"g");o=o.replace(/{{i}}/g,e.toString()),o=o.replace(l,r.innerHTML),n.innerHTML+=o}}}},generateIfs=()=>{const e=e=>e.getAttribute("exists")||e.getAttribute("exist")?"exists":e.getAttribute("not-exists")||e.getAttribute("notexists")||e.getAttribute("not-exist")||e.getAttribute("notexist")?"not-exists":void 0,t=document.querySelectorAll("if");for(let n=0;n<t.length;n++){const r=t[n],o=e(r),s=r.getAttribute(o),i="ELSE"===r.nextSibling.nodeName?r.nextSibling:"";if("exists"===o)if(s.startsWith("{{")&&s.endsWith("}}")){let e=!1;const t=s.replace(/^{{/,"").replace(/}}$/,""),n=document.querySelectorAll("set");for(let r=0;r<n.length;r++){const o=n[r];t===o.getAttribute("name")&&(e=!0)}if(!0===e){""!==i&&i.remove();const e=r.innerHTML;r.after(e),r.remove()}else if(r.remove(),""!==i){const e=i.innerHTML;i.after(e),i.remove()}}else{const e=document.querySelector(s);if(e){""!==i&&i.remove();const e=r.innerHTML;r.after(e),r.remove()}else if(r.remove(),""!==i){const e=i.innerHTML;i.after(e),i.remove()}}else if("not-exists"===o)if(s.startsWith("{{")&&s.endsWith("}}")){let e=!1;const t=s.replace(/^{{/,"").replace(/}}$/,""),n=document.querySelectorAll("set");for(let r=0;r<n.length;r++){const o=n[r];t!==o.getAttribute("name")&&i===o.getAttribute("name")&&(e=!0)}if(!1===e){""!==i&&i.remove();const e=r.innerHTML;r.after(e),r.remove()}else if(r.remove(),""!==i){const e=i.innerHTML;i.after(e),i.remove()}}else{const e=document.querySelector(s);if(e){if(r.remove(),""!==i){const e=i.innerHTML;i.after(e),i.remove()}}else{""!==i&&i.remove();const e=r.innerHTML;r.after(e),r.remove()}}}};let css='<style type="text/css">set,function{display:none;}</style>';document.head.insertAdjacentHTML("beforeend",css);const generateFunctions=()=>{const e=document.querySelectorAll("function");let t={};for(let n=0;n<e.length;n++){const r=e[n],o=r.getAttribute("name"),s=r.getAttribute("arguments");t[o]={},t[o].content=r.innerHTML,t[o].arguments=s.split(" "),r.remove()}document.body.innerHTML=document.body.innerHTML.replace(/{{(.*?)}}/g,function(e,n){if(!0===/\(.*?\)$/.test(n)){const r=n.replace(/\((.*?)\)$/,"");let o,s=n.replace(/(.*?)(?=\(.*?\))/,"").replace(/^\(|\)$/g,"").split(",");for(let e=0;e<s.length;e++)s[e]=s[e].trim();try{o=t[r].content}catch(t){return e}return o=o.replace(/{{(.*?)}}/g,(e,n)=>{for(let e=0;e<t[r].arguments.length;e++){const o=t[r].arguments[e];if(o===n)return s[e]}}),o}return`{{${n}}}`})};generateFors(),generateIfs(),generateFunctions(),generateVariables();
